<!DOCTYPE html>
<html>
<head>
    <meta charset = "utf-8"/>
    <title>Calendar</title>
    <link rel = "stylesheet" type = "text/css" href="calStyleSheet.css">
    <!-- includes jQuery-->
    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <!-- includes dataTables -->
	<script src = "https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css"></script>
	<script src = "https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>   
</head>
<body>
    <div id = "wrapper">
        
        <div id = "header">
            
			<div id = "viewButtons">	
				<button id = weekButton class = viewButton type = "button">Week</button>
				<button id = monthButton class = viewButton type = "button">Month</button>
				<button id = yearButton class = viewButton type = "button">Year</button>
				
				<script src = "viewButtons.js"></script>
			</div>
			
			<div id = "userButtons">	
				<button id = loginButton class = userButton type = "button">Login</button>
				<button id = logoutButton class = userButton type = "button">Logout</button>
				<button id = signupButton class = userButton type = "button">Sign Up</button>
			</div>
			
        </div>
        
        <div id = "main">
            
            <div id = "nav">
                <div id = "goTo">
					<select id = "months">
						<option id = "Jan" class = monthSelection value = "January">January</option>
						<option id = "Feb" class = monthSelection value = "February">February</option>
						<option id = "Mar" class = monthSelection value = "March">March</option>
						<option id = "Apr" class = monthSelection value = "April">April</option>
						<option id = "May" class = monthSelection value = "May">May</option>
						<option id = "Jun" class = monthSelection value = "June">June</option>
						<option id = "Jul" class = monthSelection value = "July">July</option>
						<option id = "Aug" class = monthSelection value = "August">August</option>
						<option id = "Sep" class = monthSelection value = "September">September</option>
						<option id = "Oct" class = monthSelection value = "October">October</option>
						<option id = "Nov" class = monthSelection value = "November">November</option>
						<option id = "Dec" class = monthSelection value = "December">December</option>
					</select>
					<br>
					<br>
					<input id = "day" type = "number" name = "day" placeholder = "Enter day here"/>
					<br>
					<br>
					<input id = "year" type = "number" name = "year" placeholder = "Enter year here"/>
					<br>
					<br>
					<button id = "goToDate" type="button">Go</button>
					<br>
					<br>
				</div>
				<div id = "switchBetween">
					<button id = "prevWeek" type = "button">Previous Week</button>
					<button id = "nextWeek" type = "button">Next Week</button>
					<br>
					<br>
					<button id = "prevMonth" type = "button">Previous Month</button>
					<button id = "nextMonth" type = "button">Next Month</button>
				</div>
            </div>
            
            <script>
				
				document.addEventListener("DOMContentLoaded", setInitial, false);
				document.getElementById("weekButton").addEventListener("click", showWeek, false);
				document.getElementById("monthButton").addEventListener("click", showMonth, false);
				document.getElementById("goToDate").addEventListener("click", goToDate, false);
				document.getElementById("prevWeek").addEventListener("click", prevWeek, false);
				document.getElementById("nextWeek").addEventListener("click", nextWeek, false);
				document.getElementById("prevMonth").addEventListener("click", prevMonth, false);
				document.getElementById("nextMonth").addEventListener("click", nextMonth, false);
				
				
				var selectedDate;
				var currentDate;
				var daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
				var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
				
				function setInitial(){
					selectedDate = new Date();
					currentDate = new Date();
					isLeapYear(selectedDate.getFullYear());
					populateMonth(currentDate)
					populateWeek(currentDate);	
				}
				
				// Populates dates for the month	
				function populateMonth(givenDay) {
						document.getElementById("monthName").innerHTML = months[givenDay.getMonth()]+", "+ givenDay.getFullYear();
						var day = daysInMonth[givenDay.getMonth()];
						var tracker = new Date(givenDay.getFullYear(), givenDay.getMonth(), day); // starts of end of month
						var weekstart;
						while (day > 0) {
							weekStart = findWeekStart(tracker, true);
							day = day-7;
							tracker = new Date(tracker.getFullYear(), tracker.getMonth(), day);
						}
						if (weekStart.getDate() < 7) {
                            tracker = new Date(tracker.getFullYear(), tracker.getMonth(), 1);
							findWeekStart(tracker, true);
                        }
					}
					
				// Populates dates for the week
				function populateWeek(givenDate) {
						findWeekStart(givenDate, false);
				}
					
				//finds the start of each week
				function findWeekStart(givenDate, forMonth) {
					var weekStart;
					var day;
						if (givenDate.getDay() != 0){ // given day not the beginning of the the week
							if (givenDate.getDate() < 6) { // if the week goes into the previous month
								if (givenDate.getMonth()==0) { //if the week goes into the previous year
									day = daysInMonth[11]-(Math.abs(givenDate.getDay()-givenDate.getDate()));
									weekStart = new Date(givenDate.getFullYear()-1, 11, day);
								} else { //if the week stays in the current year
									day = daysInMonth[givenDate.getMonth()-1]-(Math.abs(givenDate.getDay()-givenDate.getDate()));
									
									weekStart = new Date(givenDate.getFullYear(), givenDate.getMonth()-1, day);
								}
							} else { // if the weeek stays in the current month
								day = Math.abs(givenDate.getDate()-givenDate.getDay());
								weekStart = new Date(givenDate.getFullYear(), givenDate.getMonth(), day);
							}
						} else { // if referenceDay is the start of the week
							day = givenDate.getDate();
							weekStart = givenDate;
						}
						populate(weekStart, day, forMonth);
					}
					
				// Populates the week or month with dates	
				function populate(givenDay, day, forMonth) {
						if (forMonth) {
							var table = document.getElementById("monthly");
						} else {
							var table = document.getElementById("weekly");
						}
						var row = table.insertRow(1);
						var tracker=givenDay;
						for (var i = 0; i < 7; i++){
							var cell = row.insertCell(i);
							cell.innerHTML = tracker.getDate();
							day = day + 1;
							if (day > daysInMonth[givenDay.getMonth()]) { // if we are at the end of the current month
								if (givenDay.getMonth()==11) { // if we are going into the next year
									day = 1;
									tracker = new Date(givenDay.getFullYear()+1, 1, day);
								} else { // if we stay in the current year
									day = 1;
									tracker = new Date(givenDay.getFullYear(), givenDay.getMonth()+1, day);
								}
							} else { //if we stay in the same month	
								tracker = new Date(givenDay.getFullYear(), givenDay.getMonth(), day);
							}
						}
						return tracker;
					}
					
				// shows week view when week button is pressed	
				function showWeek() {
						document.getElementById("weekly").style.display="table";
						document.getElementById("monthly").style.display="none";
					}
				
				// shows month view when month button is pressed	
				function showMonth() {
						document.getElementById("monthly").style.display="table";
						document.getElementById("weekly").style.display="none";
					}
					
				//determines if the year is a leap year	
					function isLeapYear(year) {
						if (year % 4 == 0) {
							if (year % 100 == 0) {
								if (year % 400 == 0) {
									daysInMonth[1]=29;
								} else {daysInMonth[1]=28;}
							} else {daysInMonth[1]=29;}
						} else {daysInMonth[1]=28;}
					}
					
					function clearTable(tableName) {
						var table = document.getElementById(tableName);
						for(var i = table.rows.length - 1; i > 0; i--)
						{
							table.deleteRow(i);
						}
					}
					
					function goToDate() {
						clearTable("monthly");
						clearTable("weekly");
				
						var dropDown = document.getElementById("months");
						var monthString = dropDown.options[dropDown.selectedIndex].text;
						var m;
						for (m in months) {
							if (monthString.substring(0,3)==months[m]) {
								var month = m;
							}
						}
						var day = document.getElementById("day").value;
						var year = document.getElementById("year").value;
						selectedDate = new Date(year, month, day);
						isLeapYear(selectedDate.getFullYear());						
						showMonth();
						populateMonth(selectedDate);
						populateWeek(selectedDate);
					}
					
					function prevWeek() {
						if (selectedDate.getDate() < 7) { // if the previous week goes into the previous month
							if (selectedDate.getMonth() == 0) { // if the previous week goes into the previous year
                                selectedDate = new Date(selectedDate.getFullYear()-1, 11, daysInMonth[11]-(7-selectedDate.getDate()));
                            } else { 
								selectedDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth()-1, selectedDate.getDate()-7);
							}
						} else { // if the previous week stays in the same month
							selectedDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), selectedDate.getDate()-7);
						}
						clearTable("weekly");
						clearTable("monthly");
						
						isLeapYear(selectedDate.getFullYear());
						showWeek();
						populateWeek(selectedDate);
						populateMonth(selectedDate);
					}
					
					function nextWeek() {
                        if (selectedDate.getDate() > daysInMonth[selectedDate.getMonth()-7]) { // if next week goes into the next month
							if (selectedDate.getMonth() == 11) { // if the next week goes into the next year
                                selectedDate = new Date(selectedDate.getFullYear()+1, 1, (7-selectedDate.getDate()));
                            } else { 
								selectedDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth()+1, selectedDate.getDate()+7);
							}
						} else { // if the next week stays in the same month
							selectedDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), selectedDate.getDate()+7);
						}
						clearTable("weekly");
						clearTable("monthly");
						
						isLeapYear(selectedDate.getFullYear());
						
						showWeek();
						populateWeek(selectedDate);
						populateMonth(selectedDate);
                    }
					
					function prevMonth() {
						if (selectedDate.getMonth() == 0) { // if the previous month goes into the previous year
                            selectedDate = new Date(selectedDate.getFullYear()-1, 11, 1);
                        } else { // if the previous month stays in the same year
							selectedDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth()-1,1);
						}
						clearTable("weekly");
						clearTable("monthly");
						
						isLeapYear(selectedDate.getFullYear());
						
						showMonth();
						populateMonth(selectedDate);
						populateWeek(selectedDate);
                    }
					
					function nextMonth() {
							if (selectedDate.getMonth() == 11) { // if the next month goes into the next year
                                selectedDate = new Date(selectedDate.getFullYear()+1, 1, 1);
                            } else { 
								selectedDate = new Date(selectedDate.getFullYear(), selectedDate.getMonth()+1, 1);
							}
				
						clearTable("weekly");
						clearTable("monthly");
						
						isLeapYear(selectedDate.getFullYear());
						
						showMonth();
						populateWeek(selectedDate);
						populateMonth(selectedDate);
                    }
				
            </script>
            
            <div id = "cal">
				<div id = "monthName">
					
				</div>
                
                <table id = "monthly" border = "1" >
                    <tr>
                        <th>Sunday</th>
                        <th>Monday</th>
                        <th>Tuesday</th>
                        <th>Wednesday</th>
                        <th>Thursday</th>
                        <th>Friday</th>
                        <th>Saturday</th>
                    </tr>
                   
                </table>
				
				<table id = "weekly" border = "1" style="display:none" >
                    <tr>
                        <th>Sunday</th>
                        <th>Monday</th>
                        <th>Tuesday</th>
                        <th>Wednesday</th>
                        <th>Thursday</th>
                        <th>Friday</th>
                        <th>Saturday</th>
                    </tr>
                   
                </table>
                
            </div>
        </div>
    </div>
</body>
</html>
